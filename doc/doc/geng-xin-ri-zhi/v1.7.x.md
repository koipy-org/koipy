# v1.7.X

## v1.7.11(2024-10-15)

1. 详细地区api新增2个接口，总共3个接口。每次测入口3个接口随机取1个
2. 新的配置项 image.pixelThreshold 用于控制图片像素阈值，超过阈值则发送原图，否则发送压缩图片
3. 新的配置项 image.invert 用于控制图片是否反色，默认不反色
4. 新的指令 /nightshift 用于控制是否开启夜间模式，原理为修改 image.invert 的值

## v1.7.10(2024-10-07)

1. 现在sub-store后端端口将沿用环境变量的设置，如果没有设置，则使用默认值3000
2. /re 指令现在支持回复一个旧的测试发起消息，如果回复了旧的测试发起消息，则尝试从被回复的那条消息中获取订阅URL
3. 新的配置项 `bot.echoLimit` 用于限制响应速度，单位秒，默认0.8秒，即bot每0.8秒最多响应一条消息，每0.8/2秒内按钮最多响应一次
4. 移除了冗余功能
5. 优化了程序结构

## v1.7.9(2024-09-29)

1. sub-store默认端口3000占用检测，如果出现端口占用，则自动部署会中止
2. 如果substore.backend 的地址不是自动部署的默认地址，则自动部署会中止，说明此刻有自建的sub-store
3. substore.path和sub-store.jsRuntime 如果在自动部署时读取到了，将不会自动下载默认的。意味着将使用用户自定义的js运行时和资源路径
4. 耗时显示现在分为测试耗时和总体耗时两部分

## v1.7.8(2024-09-28)

1. 新的runtime配置项：runtime.disableSubCvt , 用于针对单次测试临时禁用全局的订阅转换
2. rule适配 runtime.disableSubCvt
3. 新的指令参数: /test?**nocvt=true**, 用于禁用全局订阅转换
4. /restart指令将优雅地重启sub-store后端

## v1.7.7(2024-09-27)

1. 优化洪水攻击防护触发阈值为1秒
2. 修复订阅转换无法识别 hy2://
3. 支持sub-store自动部署，相关配置 substore.autoDeploy
4. 支持设置sub-store的部署路径，相关配置 substore.path
5. 支持设置sub-store的js运行时，目前koipy自动下载的运行时为bun (https://bun.sh/)，相关配置 substore.jsRuntime
6. 自动部署的sub-store后端端口为3000，监听地址为127.0.0.1，暂时无法修改。如需修改，请手动部署sub-store
7. 修复sub-store套娃转换导致节点测试的问题
8. 修复并优化构建脚本，感谢 @qianlongzt 的代码贡献

## v1.7.4

1. 每份测试的节点数量限制现在仅对没有用户权限的目标生效
2. 基本的洪水攻击防护（实验性功能），当bot检测一个消息发送过快时会自动暂停对消息响应，以便节约计算资源

针对bot的洪水攻击说明：

1. 将多个正常的TG账号绑定到userbot，以滥用api的方式向bot发送消息
2. bot响应消息，发送消息均需要消耗api资源，api调用频率受TG官方限制

## v1.7.3 (2024-09-21)

1. 支持使用 sub-store 进行订阅转换
2. 当subconveter与sub-store同时使用时，sub-store将优先使用

以下是启用sub-store的配置示例：

```yaml
substore:
  enable: true
  backend: http://localhost:3000/download/sub?target=ClashMeta
  ua: "ClashMeta/0.17.0"
```

sub-store 是一个订阅管理工具，它可以将订阅里面的节点信息进行修改复写，通过排序，过滤，重新组合等操作，而且有一个非常友好的前端界面，可以方便地管理订阅。

koipy 仅使用其中的 sub-store 的订阅转换功能。

sub-store 文档指南：

```
https://xream.notion.site/Sub-Store-abe6a96944724dc6a36833d5c9ab7c87 
https://t.me/zhetengsha/214
```

## v1.7.2 (2024-09-12)

1. subinfo 现在支持直接查询规则里包含的订阅链接的流量信息。例子: /subinfo tag
2. 修复一些使用bug
3. 优化代码结构
4. 优化日志输出
5. 现在不包含测速项将不支持实时渲染

## v1.7.1

1. 实时渲染现在仅对拥有BOT用户权限的使用者开放
2. 节点数量超过40个将拒绝渲染
3. 新的指令参数 realtime=true ，可以在测试开始时就启用渲染图片。例子： /test?realtime=true
4. 新的配置runtime.realtime，可以设置是否启用实时渲染，现已支持附加到规则
5. 图片太宽将发出提示信息
6. 实时渲染开启时将不再显示进度条

## v1.7.0

1. 支持测试过程中实时渲染
2. 修复规则在invite的优先级
3. 修复图片中文路径问题
